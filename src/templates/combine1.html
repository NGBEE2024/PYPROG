<!DOCTYPE html>
<html>
<head>
    <title>Plant Care System</title>
    <style>
        .section { display: none; }
        .active { display: block; }
        .nav-btn { margin: 10px; padding: 5px; }
    </style>
</head>
<body>
    <div>
        <button class="nav-btn" onclick="showSection('control')">System Control</button>
        <button class="nav-btn" onclick="showSection('servo')">Servo Settings</button>
        <button class="nav-btn" onclick="showSection('tank')">Water Tank</button>
    </div>

    <!-- System Control Section -->
    <div id="control" class="section active">
        <h1>Plant Care System</h1>
        <div class="status">
            <p><strong>System Status:</strong> {{ "Enabled" if state.system else "Disabled" }}</p>
            <p><strong>Temperature & Humidity:</strong> {{ "Enabled" if state.temperature_humidity else "Disabled" }}</p>
            <p><strong>LDR Monitoring:</strong> {{ "Enabled" if state.ldr else "Disabled" }}</p>
        </div>
        <form action="/toggle" method="post">
            <button type="submit" name="toggle" value="system">Toggle System</button>
            <button type="submit" name="toggle" value="temperature_humidity">Toggle Temp & Humi</button>
            <button type="submit" name="toggle" value="ldr">Toggle LDR</button>
        </form>
    </div>

    <!-- Servo Settings Section -->
    <div id="servo" class="section">
        <h1>Set Servo Delay</h1>
        <form action="/set_delay" method="POST">
            <label>Delay (4-20s):</label>
            <input type="number" name="sdelay" min="4" max="20" value="{{ sdelay }}" required>
            <button type="submit">Set Delay</button>
            <div class="chart">
                <h3>Temperature (Field 1)</h3>
                <iframe width="450" height="260" style="border: 1px solid #cccccc;" 
                    src="https://thingspeak.com/channels/2746200/charts/1?results=5&dynamic=true">
                </iframe>
            </div>
        
            <!-- Humidity Chart -->
            <div class="chart">
                <h3>Humidity (Field 2)</h3>
                <iframe width="450" height="260"  
                    src="https://thingspeak.com/channels/2746200/charts/2?results=5&dynamic=true">
                </iframe>
            </div>
        </form>
    </div>

    <!-- Water Tank Section -->
    <div id="tank" class="section">
        <h1>Water Tank Monitor</h1>
        <p>Days since last refill: <span id="days">{{ days }}</span></p>
        <p>Last Refill Time: <span id="last_refill_time">{{ last_refill }}</span></p>
        <iframe width="450" height="260" src="https://thingspeak.com/channels/2746200/charts/3?results=5&dynamic=true"></iframe>
    </div>

    <script>
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(div => div.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        function updateTankData() {
            fetch('/update')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('days').textContent = data.days_since_refill;
                    document.getElementById('last_refill_time').textContent = data.last_refill_timestamp;
                });
        }
        setInterval(updateTankData, 5000);
    </script>
</body>
</html>